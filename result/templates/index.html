<!DOCTYPE html>
<html lang="en">
    <head>
        {% load static %}
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Dashboard - SB Admin</title>
        <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
        <!-- Chart js Scripts-->
   <script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/dist/chart.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.0.0/chartjs-plugin-datalabels.min.js" ></script>
        <link href="{% static 'css/STYLES.css' %} " rel="stylesheet" />
        <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
        <style>
          @media (min-width: 576px){
		        .modal-dialog {
			        min-width: 75%;
			        margin-left:15%;
		        }
          }
        </style>
    </head>    
    <body class="sb-nav-fixed">
        <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
            <!-- Navbar Brand-->
            <a class="navbar-brand ps-3" href="home">Result Analyizer</a>
            <!-- Sidebar Toggle-->
            <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>
            <!-- Navbar Search-->
            <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
                <div class="input-group">
                    <input class="form-control" type="text" placeholder="Search for..." aria-label="Search for..." aria-describedby="btnNavbarSearch" />
                    <button class="btn btn-primary" id="btnNavbarSearch" type="button"><i class="fas fa-search"></i></button>
                </div>
            </form>
            <!-- Navbar-->
            <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="#!">Settings</a></li>
                        <li><a class="dropdown-item" href="#!">Activity Log</a></li>
                        <li><hr class="dropdown-divider" /></li>
                        <li><a class="dropdown-item" href="{% url 'logout'%}">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                    <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                        <div class="sb-sidenav-menu">
                            <div class="nav">
                                <div class="sb-sidenav-menu-heading">Core</div>
                                <a class="nav-link" href="{% url 'index'%}">
                                    <div class="sb-nav-link-icon"><i class="fas fa-home-alt"></i></div>
                                    Home
                                </a>
                                <a class="nav-link" href="{% url 'batch'%}">
                                  <div class="sb-nav-link-icon"><i class="fas fa-home-alt"></i></div>
                                  Add Batch
                                </a>
                                <a class="nav-link" href="{% url 'home'%}">
                                    <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                    Dashboard
                                </a>
                                <a class="nav-link" href="{% url 'retrive'%}">
                                    <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                    Results
                                </a>
                                
                                
                                
                                
                            </div>
                        </div>
                        <div class="sb-sidenav-footer">
                            <div class="small">Logged in as:</div>
                            Start Bootstrap
                        </div>
                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                  <div class="breadcrumb  m-3 d-flex flex-row-reverse">    
                      <a class="nav-link " href="{% url 'retrive'%}">Result >></a>
                  </div>
                    <div class="container-fluid px-4">
                        
                        
                      {% if context %}
                        <div class="row">
                            
                            <div class="col-xl-4 col-md-6">
                                <div class="card bg-primary text-white mb-4">
                                    {% if context.n %}
                                    <div class="card-body">Total :{{context.n}}</div>
                                    {%else%}
                                    <div class="card-body">Total </div>
                                    {% endif %}
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-xl-4 col-md-6">
                                <div class="card bg-success text-white mb-4">
                                    {% if context.all_pass %}
                                    <div class="card-body">Passed:{{context.all_pass}}</div>
                                    {%else%}
                                    <div class="card-body">Passed</div>
                                    {% endif %}
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-4 col-md-6">
                                <div class="card bg-danger text-white mb-4">
                                    {% if context.all_fail %}
                                    <div class="card-body">Failed:{{context.all_fail}}</div>
                                    {%else%}
                                    <div class="card-body">Failed</div>
                                    {% endif %}
                                    <div class="card-footer d-flex align-items-center justify-content-between">
                                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                                    </div>
                                </div>
                            </div>
                            {% comment %} {% for i in content.res%} {% endcomment %}
                            
                            
                            {% comment %} {% endfor%} {% endcomment %}
                            
                            
                        </div>
                        <table class="table table-bordered">
                            <thead>
                              <tr class="bg-primary">
                                <th scope="col">Section</th>
                                {% for j in context.sections_list%}
                                <th scope="col">{{j}}</th>
                                {%endfor%}
                                {% for j in context.sections_list%}
                                <th scope="col">{{j}} Pass %</th>
                                {%endfor%}

                              </tr>
                            </thead>
                            <tbody>
                                
                              <tr class="bg-success">
                                <th scope="row">Total Passed</th>
                                {% for i in context.Section_Pass %}
                                <td >{{i}}</td>
                                {% endfor%}
                                {% for i in context.pass_percentage %}
                                <td>{{i}}</td>
                                {% endfor%}

                              </tr>
                              
                              
                              <tr class="bg-danger">
                                <th scope="row">Total Failed</th>
                                {% for i in context.Section_Fail %}
                                <td>{{i}}</td>
                                {% endfor%}
                                {% for i in context.fail_percentage %}
                                <td>{{i}}</td>
                                {% endfor%}

                              </tr>
                              
                              
                            </tbody>
                          </table>
                          {% endif %}
                        <div class="row ">
                            <div class="col-xl-6 ">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-area me-1"></i>
                                        Semester wise Results
                                    </div>
                                    <div class="card-body"><canvas id="myAreaChart" width="100%" height="40"></canvas></div>
                                </div>
                            </div>
                            <div class="col-xl-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-bar me-1"></i>
                                        Section wise Results
                                    </div>
                                    <div class="card-body " ><canvas id="myBarChart" class="h-100"  >
                                        
                                    </canvas></div>
                                </div>
                            </div>

                            <div class="col-xl-6 m-auto">
                                <div class="card mb-4 ">
                                    <div class="card-header ">
                                        <i class="fas fa-chart-bar me-1"></i>
                                        Failures in each Section
                                    </div>
                                    <div class="card-body"><canvas id="myPieChart" width="100%" height="40">
                                        
                                    </canvas></div>
                                </div>
                            </div>
                        </div>
                        <div class="w-100 text-center">
                          <button type="button"  class="btn btn-primary mx-auto"   data-bs-toggle="modal" data-bs-target="#exampleModal">Results</button>
                        </div>
                      <!-- Modal -->
                      <div class="modal fade col-md-10 mb-3" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                          <div class="modal-dialog modal-dialog-centered ">
                              <div class="modal-content">
                                  <div class="w-100">
                                    <button type="button" class="btn-close float-end" data-bs-dismiss="modal" aria-label="Close"></button>
                                  </div>  
                                  <div class="modal-body">
                                    <section class="get_in_touch mt-2" id="content">
                                      <div class="d-flex justify-content-center">
                                        <img height="100" width="100" src="{% static 'imgs/logo.png' %} ">
                                      </div> 

                                      <h1 class="title text-center fw-bold">Malla Reddy College Of Engineering And Technology</h1>
                                      {% comment %} <h2 class="title text-center">2018-2022</h2> {% endcomment %}
                                      <h3 class="title text-center mb-3">{{context.sem}} Results Report</h3>
                                      <div class="row">
                                        <div class="col-md-6">
                                          <div class="card mb-4">
                                              <div class="card-header text-center fw-bold bg-primary text-white">
                                                  <i class="fas fa-chart-bar me-1"></i>
                                                  Section wise Results
                                              </div>
                                              <div class="card-body">
                                                <canvas id="myBarChart2" class="w-100">
                                                  
                                              </canvas>
                                              </div>
                                          </div>
                                         </div> 
                                          <div class="table-responsive col-md-6">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th colspan="6" class="text-center fw-bold bg-warning text-white">CSE Toppers</th>
                                                    </tr>
                                                    <tr>
                                                      <th scope="col">Sno</th>
                                                      <th scope="col" style="width:47%">RollNo</th>
                                                      <th scope="col">CGPA</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                    <!--Keep For loop for each Subject-->
                                                    {%for i,j in context.Total_top.items%}
                                                    <tr>
                                                      <td>*</td>
                                                      <td>{{i}}</td>
                                                      <td>{{j}}</td>
                                                    </tr>
                                                    {%endfor%}

                                                    
                                                  </tbody>
                                            </table>
                                          </div>
                                      </div>
                                      <div class="row" >
                                        <div class="table-responsive col-md-6">
                                          <table class="table table-bordered">
                                            <thead>
                                              <tr>
                                                  <th colspan="6" class="text-center fw-bold bg-warning text-white">Total Passed</th>
                                              </tr>
                                             
                                            </thead>
                                            <tbody>
                                              <!--Keep For loop for each Subject-->
                                              {% for i,v in context.Total_analysis_pass.items%}
                                              <tr style="text-center">
                                                <th scope="col" >{{i}}</th>
                                                {% comment %} <th scope="col" class="w-50">Passed All Subjects</th> {% endcomment %}
                                                <td scope="col">{{v}}</td>
                                                
                                              </tr>
                                              {%endfor%}
                                            </tbody>
                                          </table>
                                        </div>
                                        <div class="table-responsive col-md-6">
                                          <table class="table table-bordered">
                                            <thead>
                                              <tr>
                                                  <th colspan="6" class="text-center fw-bold bg-primary text-white">Total Analysis</th>
                                              </tr>
                                              <tr>
                                                <th scope="col" class="w-25">Section</th>
                                                <th scope="col" class="w-25">One Subjects Failed</th>
                                                <th scope="col" class="w-25">Two Subjects Failed</th>
                                                <th scope="col" class="w-25">More Than 2 Subjects Failed</th>
                                              </tr>
                                            </thead>
                                            <tbody>
                                              <!--Keep For loop for each Subject-->
                                              {% for k,v in context.Total_analysis_fail.items%}
                                              <tr>
                                                
                                                <th scope="col">{{k}}</th>
                                                {%for i in v%}
                                                <td scope="col">{{i}}</td>
                                                {%endfor%}
                                                
                                              </tr>
                                              {%endfor%}
                                              
                                            </tbody>
                                          </table>
                                        </div>
                                      </div>
                                      <div class="row">
                                      {%for k,r in context.Section_wise_result.items%}
                                      <div class="table-responsive col-md-6">
                                      <table class="table table-bordered">
                                          <thead>
                                            
                                              <tr>
                                                  <th colspan="6" class="text-center fw-bold bg-success text-white">Section {{k}}</th>
                                              </tr>
                                              <tr>
                                                <th scope="col">Subject</th>
                                                <th scope="col" style="width:47%">Faculty</th>
                                                <th scope="col">Total</th>
                                                <th scope="col">Pass</th>
                                                <th scope="col">Fail</th>
                                                <th scope="col">Pass %</th>
                                              </tr>
                                            </thead>
                                            <tbody>
                                              <!--Keep For loop for each Subject-->
                                              {%for l,v in r.items%}
                                            <tr>
                                             <th scope="row">{{l}}</th>
                                             {%for i in v%}
                                              <td>{{i}}</td>
                                              {%endfor%}
                                           </tr>
                                           {%endfor%}
                                           
                                            </tbody>
                                      </table>
                                      </div>
                                      {%endfor%}
                                      
                                    </div>
                                      

                                    
                                      
                                     <table class="table table-bordered mt-2" >
                                      <thead>
                                        <tr>
                                          <th colspan="6" class="text-center fw-bold bg-secondary text-white">Subject Wise</th>
                                        </tr>
                                        <tr>
                                         <th scope="col" class="w-50">Subject</th>
                                         <th scope="col">Total</th>
                                         <th scope="col">Pass</th>
                                         <th scope="col">Fail</th>
                                         <th scope="col">Pass %</th>
                                         <th scope="col">Fail %</th>
                                       </tr>
                                      </thead>
                                      <tbody>
                                      <!--Keep For loop for each Subject-->
                                      {%for k,v in context.Total_subjects.items%}
                                      <tr>
                                       <th scope="row">{{k}}</th>
                                       {%for i in v%}
                                        <td>{{i}}</td>
                                        {%endfor%}
                                     </tr>
                                     {%endfor%}
                                      </tbody>
                                   </table>
                                   
                              {%for k,r in context.Section_wise_toppers.items%}    
                            <table class="table table-bordered mt-2" >
                              
                              <thead>
                                <tr class="bg-secondary text-white">
                                    <th colspan="6">{{k}} Section Toppers</th>
                                </tr>
                                
                                <tr>
                                  <th scope="col" colspan='1'>Sno</th>
                                  <th scope="col" colspan='2' style="width:47%">RollNo</th>
                                  <th scope="col" colspan='3'>CGPA</th>
                                </tr>
                              </thead>
                              <tbody>
                                <!--Keep For loop for each Subject-->
                                {%for i,j in r.items%}
                                <tr>
                                  <td colspan='1'>*</td>
                                  <td colspan='2'>{{i}}</td>
                                  <td colspan='3'>{{j}}</td>
                                </tr>
                                {%endfor%}
                              </tbody>
                              
                            </table>
                            {%endfor%}       
                                  </section>
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" id="pdf">Download Pdf</button>
                                  </div>
                              </div>
                          </div>
                          </div>
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-table me-1"></i>
                                DataTable Example
                            </div>
                            <div class="card-body">
                                <table id="datatablesSimple">
                                    <thead>
                                        <tr>
                                          {% for data in context.lis %} 
                                            <th>{{ data }}</th> 
                                          {% endfor %} 
                                        </tr>
                                    </thead>
                                    <tbody>

                                      {% for _, data in context.lis.iterrows %} 
                                      <tr> 
                                        {% for value in data %} 
                                          <td>{{ value }}</td> 
                                        {% endfor %} 
                                      </tr> 
                                    {% endfor %} 
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>
                <footer class="py-4 bg-light mt-auto">
                    <div class="container-fluid px-4">
                        <div class="d-flex align-items-center justify-content-between small">
                            <div class="text-muted">Copyright &copy; Your Website 2022</div>
                            <div>
                                <a href="#">Privacy Policy</a>
                                &middot;
                                <a href="#">Terms &amp; Conditions</a>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="{% static 'js/scripts.js' %} "></script>
        
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
        <script src="{% static 'js/datatables-simple-demo.js' %} "></script>
        <script src="https://code.jquery.com/jquery-3.6.0.js" ></script>
        <script>
          $(document).ready(function(){
            
        $("#pdf").on('click', function(){
          const invoice = document.getElementById("content");
                    console.log(invoice);
                    console.log(window);
                    var opt = {
                        margin: 0.2,
                        filename: 'myfile.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2 },
                        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                    };
                    html2pdf().from(invoice).set(opt).save();
          
        
        // Default export is a4 paper, portrait, using millimeters for units
        
        
        
        
        });
        });
        </script>
    </body>
    <script>
       

      // Area Chart Example
      var pass_={{context.allsems_pass_dict}}
      var fail_={{context.allsems_fail_dict}}
      var sem_={{context.allsems_sem_dict|safe}}

      var ctx = document.getElementById("myAreaChart");
      var myLineChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: sem_,
          datasets: [{
            label: "Sessions",
            lineTension: 0.3,
            borderColor: "green",
              pointRadius: 5,
              pointBackgroundColor: "green",
              pointBorderColor: "green",
              pointHoverRadius: 5,
            pointHoverBackgroundColor: "rgba(2,117,216,1)",
            pointHitRadius: 50,
            pointBorderWidth: 2,
            data: pass_,
          },
          {
              label: "Sessions 2",
              lineTension: 0.3,
              borderColor: "red",
              pointRadius: 5,
              pointBackgroundColor: "red",
              pointBorderColor: "red",
              pointHoverRadius: 5,
              pointHoverBackgroundColor: "rgba(2,117,216,1)",
              pointHitRadius: 50,
              pointBorderWidth: 2,
              data: fail_,
          }
        ],
        },
        plugins: [ChartDataLabels],
                  
                  options: {
                    responsive:true,
                    layout: {
                      padding: 20
                    },
                    plugins: {
                        datalabels: {
                          anchor:'end',
                          align:'end'
                        },
                        legend: {
                          display:false										
                        },
                        
                        
                      },
                    
                    scales: {
                      y: {
                        beginAtZero: true,
                        grid:{
                          display:false
                        }
                        
                      },
                      x: {
                        grid:{
                          display:false
                        }
                        
                      },
                      
                    
                      
          
                      
                    },
                  }
      });
      
      
      </script>
          
      <script>
        //---------------------- 
        var pass={{context.Section_Pass}};
        var fail={{context.Section_Fail}};

        var section={{context.sections_list|safe}};
        var ctx = document.getElementById("myBarChart");
        var barGraph = new Chart(ctx, {
                              type: 'bar',
                              data: {
      labels: section,
      datasets: [
          {
              label: "Pass",
              backgroundColor: "green",
              borderColor: "rgba(2,117,216,1)",
              data: pass,
          },
          {
              label: "Fail",
              backgroundColor: "red",
              borderColor: "rgba(2,117,216,1)",
              data: fail,
          },
          
        ]
        },
                  plugins: [ChartDataLabels],
                  
                  options: {
                    responsive:true,
                    layout: {
                      padding: 20
                    },
                    plugins: {
                        datalabels: {
                          anchor:'end',
                          align:'end'
                        },
                        legend: {
                          display:false										
                        },
                        
                        
                      },
                    
                    scales: {
                      y: {
                        beginAtZero: true,
                        grid:{
                          display:false
                        }
                        
                      },
                      x: {
                        grid:{
                          display:false
                        }
                        
                      },
                      
                    
                      
          
                      
                    },
                  }
      });
                    
              
      
        //---------------------- 
        var pass={{context.Section_Pass}};
        var fail={{context.Section_Fail}};
        var section={{context.sections_list|safe}};

        var ctx = document.getElementById("myBarChart2");
        var barGraph = new Chart(ctx, {
                              type: 'bar',
                              data: {
      labels: section,
      datasets: [
          {
              label: "Pass",
              backgroundColor: "green",
              borderColor: "rgba(2,117,216,1)",
              data: pass,
          },
          {
              label: "Fail",
              backgroundColor: "red",
              borderColor: "rgba(2,117,216,1)",
              data: fail,
          },
          
        ]
        },
                  plugins: [ChartDataLabels],
                  
                  options: {
                    responsive:true,
                    layout: {
                      padding: 20
                    },
                    plugins: {
                        datalabels: {
                          anchor:'end',
                          align:'end'
                        },
                        legend: {
                          display:false										
                        },
                        
                        
                      },
                    
                    scales: {
                      y: {
                        beginAtZero: true,
                        grid:{
                          display:false
                        }
                        
                      },
                      x: {
                        grid:{
                          display:false
                        }
                        
                      },
                      
                    
                      
          
                      
                    },
                  }
      });
                    
              
    
// Pie Chart Example
var fail={{context.Section_Fail}}
var sections={{context.sections_list|safe}}
var ctx = document.getElementById("myPieChart");
var myPieChart = new Chart(ctx, {
  type: 'pie',
  data: {
    labels:sections,
    datasets: [{
      data: fail,
      backgroundColor: ['#007bff', '#dc3545', '#ffc107', '#28a745'],
    }],
  },
  

        plugins: [ChartDataLabels],
                  
                  options: {
                    responsive:true,
                    layout: {
                      padding: 20
                    },
                    plugins: {
                        datalabels: {
                          anchor:'end',
                          align:'end'
                        },
                        legend: {
                          display:false										
                        },
                        
                        
                      },
                    
                    scales: {
                      y: {
                        beginAtZero: true,
                        grid:{
                          display:false
                        }
                        
                      },
                      x: {
                        grid:{
                          display:false
                        }
                        
                      },
                      
                    
                      
          
                      
                    },
                  }
      });
        
      
      
          
        
                    
      //--------------------------------
      // Bar Chart Example
      /*
      var ctx = document.getElementById("myBarChart");
      var myLineChart = new Chart(ctx, {
      type: 'bar',
      data: {
      labels: ["Section A", "Section B", "Section C", "Section D"],
      datasets: [
          {
              label: "Pass",
              backgroundColor: "green",
              borderColor: "rgba(2,117,216,1)",
              data: pass,
          },
          {
              label: "Fail",
              backgroundColor: "red",
              borderColor: "rgba(2,117,216,1)",
              data: fail,
          },
          
      ]
      },
      Plugins:[ChartDatalabels],
      options: {
        Plugins:{
          legend:{
            display:false
          }
        },
      scales: {
        xAxes: [{
          time: {
            unit: 'month'
          },
          gridLines: {
            display: false
          },
          ticks: {
            maxTicksLimit: 6
          }
        }],
        yAxes: [{
          ticks: {
            min: 0
          },
          gridLines: {
            display: true
          }
        }],
      },
      legend: {
        display: true
      }
      },
      
       
      });*/
      
      </script>
      
</html>
